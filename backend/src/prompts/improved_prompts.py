"""
개선된 프롬프트 템플릿

n8n Code 노드에서 사용할 수 있는 프롬프트들입니다.
기존 프롬프트 대비 다음 개선사항 적용:
1. Few-shot 예시 추가
2. Chain-of-Thought 유도
3. 출력 형식 명확화
4. 컨텍스트 보강
"""

# ========== 이메일 분석 프롬프트 (개선 버전) ==========

ANALYSIS_PROMPT_V2 = """당신은 이메일 분류 전문가입니다. 다음 이메일을 분석해주세요.

## 분석 대상 이메일
- 발신자: {sender_name} <{sender_address}>
- 제목: {subject}
- 본문:
{body_text}

## 분석 단계 (Chain-of-Thought)

**1단계: 발신자 분석**
먼저 발신자 이메일 도메인을 확인하세요:
- 기업 도메인 (예: @company.com) → 비즈니스 관련
- 학교 도메인 (예: @univ.ac.kr) → 학교 관련
- 개인 도메인 (예: @gmail.com, @naver.com) → 개인 또는 다양한 용도

**2단계: 제목 키워드 분석**
제목에서 핵심 키워드를 찾으세요:
- 면접, 채용, 지원 → 채용
- 할인, 프로모션, 이벤트 → 마케팅
- 공지, 안내, 변경사항 → 공지
- 개인적 문의, 안부 → 개인

**3단계: 본문 내용 분석**
- 요청사항이 있는가?
- 답변이 필요한 질문이 있는가?
- 긴급성을 나타내는 표현이 있는가?

## Few-shot 예시

### 예시 1: 채용 이메일
입력: "[ABC회사] 서류 전형 합격 및 면접 안내"
분석결과:
```json
{{
    "email_type": "채용",
    "importance_score": 9,
    "needs_reply": true,
    "sentiment": "positive",
    "key_points": ["서류 합격 안내", "면접 일정 조율 필요"]
}}
```

### 예시 2: 마케팅 이메일
입력: "[런팟] Load balancer is live!"
분석결과:
```json
{{
    "email_type": "마케팅",
    "importance_score": 3,
    "needs_reply": false,
    "sentiment": "neutral",
    "key_points": ["신규 기능 소개", "프로모션 정보"]
}}
```

### 예시 3: 공지 이메일
입력: "서울시청 당현천 개장 안내"
분석결과:
```json
{{
    "email_type": "공지",
    "importance_score": 4,
    "needs_reply": false,
    "sentiment": "positive",
    "key_points": ["시설 개장 안내"]
}}
```

## 출력 형식 (JSON만 출력)

위 단계를 따라 분석 후, 아래 JSON 형식으로만 응답하세요:

```json
{{
    "email_type": "<채용|마케팅|공지|개인|기타 중 하나>",
    "importance_score": <1-10 정수, 10이 가장 중요>,
    "needs_reply": <true 또는 false>,
    "sentiment": "<positive|neutral|negative 중 하나>",
    "key_points": ["<핵심 포인트 1>", "<핵심 포인트 2>"]
}}
```

중요도 점수 가이드:
- 9-10: 즉시 대응 필요 (면접, 긴급 요청)
- 7-8: 중요함 (업무 관련, 답변 필요)
- 4-6: 보통 (일반 공지, 정보성)
- 1-3: 낮음 (스팸성, 광고)
"""

# ========== 답변 생성 프롬프트 (개선 버전) ==========

REPLY_PROMPT_V2 = """당신은 한국어 이메일 답변 전문가입니다. 다음 이메일에 대한 답변을 3가지 톤으로 작성해주세요.

## 원본 이메일
- 발신자: {sender_name} <{sender_address}>
- 제목: {subject}
- 본문:
{body_text}

## 답변 작성 가이드

**1. 문맥 파악**
- 이메일의 핵심 요청/질문이 무엇인가?
- 발신자가 기대하는 답변은 무엇인가?
- 추가 정보 제공이 필요한가?

**2. 톤별 특성**

| 톤 | 특성 | 호칭 | 끝맺음 |
|------|------|------|------|
| formal | 격식체, 비즈니스 | ~님, ~께 | 감사합니다, 드림 |
| casual | 친근함, 반말X | ~님 | 감사합니다~ |
| brief | 핵심만, 간결 | ~님 | 감사합니다 |

**3. 필수 포함 요소**
- 인사 (안녕하세요)
- 받은 이메일에 대한 언급 (메일 감사히 받았습니다 / 확인했습니다)
- 핵심 응답 내용
- 마무리 인사

## Few-shot 예시

### 예시: 면접 일정 안내 이메일에 대한 답변

**formal (격식체)**:
```
안녕하세요.

면접 일정 안내 메일 감사히 받았습니다.

안내해 주신 일정(12월 5일 오후 2시)에 참석 가능합니다.
말씀해 주신 준비물도 빠짐없이 준비하여 방문하겠습니다.

감사합니다.
홍길동 드림
```

**casual (친근함)**:
```
안녕하세요!

면접 안내 메일 잘 받았습니다.
알려주신 일정에 참석 가능합니다~

준비물도 챙겨가겠습니다.
감사합니다!
```

**brief (간결함)**:
```
안녕하세요.

면접 일정 확인했습니다.
해당 일시에 참석하겠습니다.

감사합니다.
```

## 출력 형식 (JSON)

```json
{{
    "formal": {{
        "tone": "격식체",
        "reply_text": "<formal 톤 답변 전문>"
    }},
    "casual": {{
        "tone": "친근함",
        "reply_text": "<casual 톤 답변 전문>"
    }},
    "brief": {{
        "tone": "간결함",
        "reply_text": "<brief 톤 답변 전문>"
    }}
}}
```
"""

# ========== 일일 요약 프롬프트 (개선 버전) ==========

SUMMARY_PROMPT_V2 = """당신은 이메일 요약 전문가입니다. 오늘 수신된 이메일들을 종합 분석하여 요약해주세요.

## 오늘의 이메일 목록
{email_list}

## 요약 작성 가이드

**1. 전체 개요** (1-2문장)
- 총 수신 건수
- 주요 카테고리 분포

**2. 중요 이메일 하이라이트** (중요도 7점 이상)
- 발신자, 제목, 핵심 내용
- 필요한 조치사항

**3. 카테고리별 요약**
- 채용 관련: N건 - 핵심 내용
- 업무 관련: N건 - 핵심 내용
- 기타: N건

**4. 조치 필요 항목** (답변 필요한 이메일)
- 긴급도 순 정렬
- 권장 조치사항

## 출력 형식

```json
{{
    "summary_date": "{summary_date}",
    "total_count": <숫자>,
    "summary": "<전체 요약 2-3문장>",
    "important_emails": [
        {{
            "id": <이메일ID>,
            "subject": "<제목>",
            "importance": <점수>,
            "action_needed": "<필요한 조치>"
        }}
    ],
    "type_distribution": {{
        "채용": <숫자>,
        "마케팅": <숫자>,
        "공지": <숫자>,
        "개인": <숫자>,
        "기타": <숫자>
    }},
    "needs_reply_count": <숫자>,
    "key_points": [
        "<핵심 포인트 1>",
        "<핵심 포인트 2>",
        "<핵심 포인트 3>"
    ]
}}
```
"""


# ========== 프롬프트 버전 관리 ==========

PROMPT_VERSIONS = {
    "analysis": {
        "v1": "기존 단순 프롬프트",
        "v2": ANALYSIS_PROMPT_V2
    },
    "reply": {
        "v1": "기존 단순 프롬프트",
        "v2": REPLY_PROMPT_V2
    },
    "summary": {
        "v1": "기존 단순 프롬프트",
        "v2": SUMMARY_PROMPT_V2
    }
}


def get_prompt(prompt_type: str, version: str = "v2") -> str:
    """프롬프트 가져오기"""
    return PROMPT_VERSIONS.get(prompt_type, {}).get(version, "")
